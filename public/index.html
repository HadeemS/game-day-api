<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Game Day Hub</title>
  <link rel="preconnect" href="https://fonts.googleapis.com" />
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
  <link href="https://fonts.googleapis.com/css2?family=Space+Grotesk:wght@400;500;600;700&display=swap" rel="stylesheet" />
  <link rel="stylesheet" href="styles.css" />
  <script>window.__GAME_DAY_API_BASE__="https://game-day-api-1.onrender.com";</script>

  <!-- If you ALSO host this page on GitHub Pages, uncomment the line below so it fetches the Render API -->
  <style>
    /* tiny helpers to avoid relying on external CSS if missing */
    body{margin:0;font-family:"Space Grotesk",system-ui,Arial;background:#0b0b0b;color:#f4f4f5}
    a{color:#7aa2ff;text-decoration:none} a:hover{text-decoration:underline}
    .shell{padding:24px;max-width:1200px;margin:0 auto}
    .hero{display:grid;gap:24px;grid-template-columns:1.2fr 1fr;margin-bottom:24px}
    .panel{background:#111827;border:1px solid #2f3846;border-radius:16px}
    .panel__header{padding:16px 16px 0}
    .preview-card{background:#111827;border:1px solid #2f3846;border-radius:16px;padding:12px;margin-bottom:12px}
    .routes-list{list-style:none;padding:0;margin:0}
    .routes-list li{display:grid;grid-template-columns:auto 1fr;gap:10px;align-items:center;margin:6px 0}
    .http-method{font-weight:700;background:#1f2937;border:1px solid #2f3846;padding:2px 6px;border-radius:8px}
    .content-grid{display:grid;grid-template-columns:1fr;gap:16px}
    .form-grid{display:grid;gap:12px;grid-template-columns:repeat(2,minmax(0,1fr));padding:16px}
    label{display:flex;flex-direction:column;gap:6px}
    .full{grid-column:1/-1}
    input,select,textarea{background:#0b0b0b;border:1px solid #2f3846;color:#f4f4f5;border-radius:10px;padding:10px}
    .form-footer{display:flex;align-items:center;gap:10px;justify-content:flex-end;padding:0 16px 16px}
    .status{margin:0;padding:8px 10px;border-radius:999px;font-size:.9rem}
    .ok{background:#064e3b;color:#d1fae5}
    .err{background:#7f1d1d;color:#fee2e2}
    .list-panel{padding:16px}
    .games-grid{display:grid;gap:12px;grid-template-columns:repeat(auto-fill,minmax(260px,1fr))}
    .card{background:#0b0b0b;border:1px solid #2f3846;border-radius:16px;overflow:hidden}
    .card img{width:100%;height:160px;object-fit:cover;display:block}
    .badge{position:absolute;top:10px;left:10px;background:#111827;border:1px solid #2f3846;border-radius:999px;padding:4px 8px;font-size:.8rem}
    .card-body{padding:12px}
    .price{font-weight:700;color:#a7f3d0}
    .muted{opacity:.8}
    .alert{color:#fecaca}
    iframe{width:100%;height:260px;border:0;border-radius:12px;background:#0b0b0b}
    @media (max-width:980px){.hero{grid-template-columns:1fr}}
  </style>
</head>
<body>
  <main class="shell">
    <header class="hero">
      <div>
        <p class="muted">Game Day API &amp; Demo</p>
        <h1>Plan must-watch matchups and keep the hype flowing.</h1>
        <p class="muted">Try the API, post a new rivalry, and see it populate instantly.</p>

        <div style="margin:16px 0">
          <p class="muted">Main 242 Home Base</p>
          <div style="display:grid;grid-template-columns:1fr 1fr;gap:8px">
            <a class="panel" style="padding:10px;display:flex;justify-content:space-between" target="_blank" href="https://github.com/HadeemS/game-day-api"><span>Server - GitHub</span><span>→</span></a>
            <a class="panel" style="padding:10px;display:flex;justify-content:space-between" target="_blank" href="https://game-day-api.onrender.com"><span>Server - Render</span><span>→</span></a>
            <a class="panel" style="padding:10px;display:flex;justify-content:space-between" target="_blank" href="https://github.com/HadeemS/game-day"><span>Client - GitHub</span><span>→</span></a>
            <a class="panel" style="padding:10px;display:flex;justify-content:space-between" target="_blank" href="https://hadeems.github.io/game-day"><span>Client - Live Site</span><span>→</span></a>
          </div>
        </div>

        <div class="panel" style="padding:16px">
          <p class="muted">Routes</p>
          <ul class="routes-list">
            <li><span class="http-method">GET</span> <a id="link-all" href="/api/games" target="_blank">/api/games</a> <p>List all games</p></li>
            <li><span class="http-method">GET</span> <a href="/api/games/1" target="_blank">/api/games/:id</a> <p>Single game</p></li>
            <li><span class="http-method">POST</span> <code>/api/games</code> <p>Add a new matchup</p></li>
          </ul>
        </div>
      </div>

      <div>
        <div class="preview-card">
          <p class="muted">Live JSON Preview (iframe)</p>
          <iframe id="json-frame" title="Game Day API response" src="/api/games" loading="lazy"></iframe>
        </div>
        <div class="preview-card">
          <p class="muted">Live JSON (pretty)</p>
          <pre id="json-pretty" style="white-space:pre-wrap;background:#111;color:#0f0;padding:12px;border-radius:12px;min-height:200px;overflow:auto;">Loading…</pre>
          <button id="refresh" style="margin-top:8px;border:none;border-radius:10px;padding:8px 12px;background:#111;color:#fff;cursor:pointer">Refresh JSON</button>
        </div>
      </div>
    </header>

    <section class="content-grid">
      <section class="panel">
        <div class="panel__header">
          <h2>Post a marquee matchup</h2>
          <p class="muted">Client-side checks mirror your server rules.</p>
        </div>
        <form id="add-form" class="form-grid" novalidate>
          <label>Matchup Title<input name="title" placeholder="Lakers vs Celtics" required /></label>
          <label>League
            <select name="league">
              <option>NBA</option><option>NFL</option><option>NCAA Football</option><option>MLB</option><option>MLS</option>
            </select>
          </label>
          <label>Date<input type="date" name="date" required /></label>
          <label>Time<input type="time" name="time" required /></label>
          <label>Venue<input name="venue" placeholder="Crypto.com Arena" required /></label>
          <label>City<input name="city" placeholder="Los Angeles, CA" required /></label>
          <label>Starting Price (USD)<input type="number" name="price" min="0" step="1" value="0" required /></label>
          <label class="full">Image path<input name="img" placeholder="/images/usc-vs-clemson.jpg" required /></label>
          <label class="full">Summary<textarea rows="3" name="summary" placeholder="What makes this matchup must-see TV?" required></textarea></label>
          <div class="form-footer">
            <span id="status" class="status" style="display:none"></span>
            <button type="submit">Share this game</button>
          </div>
        </form>
      </section>

      <section class="panel list-panel">
        <div class="panel__header">
          <h2>Upcoming spotlight games</h2>
          <p class="muted">Every time you post, the schedule updates instantly.</p>
        </div>
        <div id="list" class="games-grid"></div>
        <p id="list-error" class="alert" style="display:none"></p>
      </section>
    </section>
  </main>

  <script>
    const API_BASE = window.__GAME_DAY_API_BASE__ || window.location.origin;

    function $(sel){ return document.querySelector(sel); }
    function el(tag, props={}, children=[]){
      const n = document.createElement(tag);
      Object.entries(props).forEach(([k,v]) => {
        if (k === 'class') n.className = v;
        else if (k === 'text') n.textContent = v;
        else n.setAttribute(k, v);
      });
      children.forEach(c => n.appendChild(c));
      return n;
    }

    function fmtDate(s){
      if(!s) return "";
      const d = new Date(s + "T00:00:00");
      return isNaN(d) ? s : d.toLocaleDateString(undefined,{weekday:"short",month:"short",day:"numeric",year:"numeric"});
    }
    function fmtMoney(n){ return "$" + Number(n||0).toLocaleString("en-US"); }

    async function loadJSON(){
      try{
        const r = await fetch(API_BASE + "/api/games");
        const data = await r.json();
        $("#json-pretty").textContent = JSON.stringify(data, null, 2);
        renderList(data);
        // fix the iframe + links to use correct base
        $("#json-frame").src = API_BASE + "/api/games";
        $("#link-all").href = API_BASE + "/api/games";
      }catch(e){
        $("#json-pretty").textContent = "Failed to load JSON.";
        $("#list-error").style.display = "";
        $("#list-error").textContent = "Unable to load games.";
      }
    }

    function renderList(items){
      const list = $("#list");
      list.innerHTML = "";
      items.sort((a,b)=> new Date(a.date+"T"+a.time) - new Date(b.date+"T"+b.time));
      items.forEach(g => {
        const card = el("article",{class:"card"},[
          (() => {
            const wrap = el("div",{style:"position:relative"});
            wrap.append(
              el("img",{src: g.img, alt: g.title, loading:"lazy"}),
              el("span",{class:"badge", text: g.league})
            );
            return wrap;
          })(),
          (() => {
            const body = el("div",{class:"card-body"});
            body.append(
              el("h3",{text:g.title}),
              el("p",{class:"muted", text: `${fmtDate(g.date)} at ${g.time}`}),
              el("p",{class:"muted", text: `${g.venue}, ${g.city}`}),
              el("p",{text:g.summary}),
              el("p",{class:"price", text: fmtMoney(g.price)})
            );
            return body;
          })()
        ]);
        list.appendChild(card);
      });
    }

    async function createGame(payload){
      const r = await fetch(API_BASE + "/api/games", {
        method: "POST",
        headers: {"Content-Type":"application/json"},
        body: JSON.stringify(payload)
      });
      const data = await r.json().catch(()=>null);
      if(!r.ok){
        const msg = (data && (data.message || data.error)) || "Server error";
        const extra = (data && data.details && data.details.join(" ")) || "";
        throw new Error(extra ? (msg + " " + extra) : msg);
      }
      return (data && (data.game || data.item)) || null;
    }

    function formStatus(type, msg){
      const box = $("#status");
      box.className = "status " + (type === "error" ? "err" : "ok");
      box.textContent = msg;
      box.style.display = "";
      setTimeout(() => { box.style.display = "none"; }, 3000);
    }

    $("#refresh").addEventListener("click", loadJSON);

    $("#add-form").addEventListener("submit", async (e) => {
      e.preventDefault();
      const fd = new FormData(e.currentTarget);
      const payload = {
        title: fd.get("title")?.trim() || "",
        league: fd.get("league") || "NBA",
        date: fd.get("date") || "",
        time: fd.get("time") || "",
        venue: fd.get("venue")?.trim() || "",
        city: fd.get("city")?.trim() || "",
        price: Number(fd.get("price") || 0),
        img: (fd.get("img") || "").trim(),
        summary: fd.get("summary")?.trim() || ""
      };
      try{
        const created = await createGame(payload);
        formStatus("ok","Game posted successfully!");
        await loadJSON(); // refresh list + pretty JSON
        // reset some fields
        e.currentTarget.reset();
      }catch(err){
        formStatus("error", err.message);
      }
    });

    // initial load
    loadJSON();
  </script>
</body>
</html>
