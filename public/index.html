<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Game Day Hub</title>
  <link rel="preconnect" href="https://fonts.googleapis.com" />
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
  <link href="https://fonts.googleapis.com/css2?family=Space+Grotesk:wght@400;500;600;700&display=swap" rel="stylesheet" />
  <link rel="stylesheet" href="styles.css" />
  <!-- React and ReactDOM from CDN -->
  <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
  <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
  <!-- Babel Standalone for JSX transformation -->
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
  <script>
    // Auto-detect if on GitHub Pages and use Render API, otherwise use relative paths for local dev
    if(window.location.hostname.includes('github.io') || window.location.hostname.includes('github.com')){
      window.__GAME_DAY_API_BASE__ = "https://game-day-api-1.onrender.com";
    }
  </script>

  <!-- If you ALSO host this page on GitHub Pages, uncomment the line below so it fetches the Render API -->
  <style>
    /* tiny helpers to avoid relying on external CSS if missing */
    body{margin:0;font-family:"Space Grotesk",system-ui,Arial;background:#0b0b0b;color:#f4f4f5}
    a{color:#7aa2ff;text-decoration:none} a:hover{text-decoration:underline}
    .shell{padding:24px;max-width:1200px;margin:0 auto}
    .hero{display:grid;gap:24px;grid-template-columns:1.2fr 1fr;margin-bottom:24px}
    .panel{background:#111827;border:1px solid #2f3846;border-radius:16px}
    .panel__header{padding:16px 16px 0}
    .preview-card{background:#111827;border:1px solid #2f3846;border-radius:16px;padding:12px;margin-bottom:12px}
    .routes-list{list-style:none;padding:0;margin:0}
    .routes-list li{display:grid;grid-template-columns:auto 1fr;gap:10px;align-items:center;margin:6px 0}
    .http-method{font-weight:700;background:#1f2937;border:1px solid #2f3846;padding:2px 6px;border-radius:8px}
    .content-grid{display:grid;grid-template-columns:1fr;gap:16px}
    .form-grid{display:grid;gap:12px;grid-template-columns:repeat(2,minmax(0,1fr));padding:16px}
    label{display:flex;flex-direction:column;gap:6px}
    .full{grid-column:1/-1}
    input,select,textarea{background:#0b0b0b;border:1px solid #2f3846;color:#f4f4f5;border-radius:10px;padding:10px}
    .form-footer{display:flex;align-items:center;gap:10px;justify-content:flex-end;padding:0 16px 16px}
    .status{margin:0;padding:8px 10px;border-radius:999px;font-size:.9rem}
    .ok{background:#064e3b;color:#d1fae5}
    .err{background:#7f1d1d;color:#fee2e2}
    .list-panel{padding:16px}
    .games-grid{display:grid;gap:12px;grid-template-columns:repeat(auto-fill,minmax(260px,1fr))}
    .card{background:#0b0b0b;border:1px solid #2f3846;border-radius:16px;overflow:hidden}
    .card img{width:100%;height:160px;object-fit:cover;display:block}
    .badge{position:absolute;top:10px;left:10px;background:#111827;border:1px solid #2f3846;border-radius:999px;padding:4px 8px;font-size:.8rem}
    .card-body{padding:12px}
    .price{font-weight:700;color:#a7f3d0}
    .muted{opacity:.8}
    .alert{color:#fecaca}
    iframe{width:100%;height:260px;border:0;border-radius:12px;background:#0b0b0b}
    @media (max-width:980px){.hero{grid-template-columns:1fr}}
  </style>
</head>
<body>
  <main class="shell">
    <header class="hero">
      <div>
        <p class="muted">Game Day API &amp; Demo</p>
        <h1>Plan must-watch matchups and keep the hype flowing.</h1>
        <p class="muted">Try the API, post a new rivalry, and see it populate instantly.</p>

        <div style="margin:16px 0">
          <p class="muted">Main 242 Home Base</p>
          <div style="display:grid;grid-template-columns:1fr 1fr;gap:8px">
            <a class="panel" style="padding:10px;display:flex;justify-content:space-between" target="_blank" href="https://github.com/HadeemS/game-day-api"><span>Server - GitHub</span><span>→</span></a>
            <a class="panel" style="padding:10px;display:flex;justify-content:space-between" target="_blank" href="https://game-day-api.onrender.com"><span>Server - Render</span><span>→</span></a>
            <a class="panel" style="padding:10px;display:flex;justify-content:space-between" target="_blank" href="https://github.com/HadeemS/game-day"><span>Client - GitHub</span><span>→</span></a>
            <a class="panel" style="padding:10px;display:flex;justify-content:space-between" target="_blank" href="https://hadeems.github.io/game-day"><span>Client - Live Site</span><span>→</span></a>
          </div>
        </div>

        <div class="panel" style="padding:16px">
          <p class="muted">Routes</p>
          <ul class="routes-list">
            <li><span class="http-method">GET</span> <a id="link-all" href="/api/games" target="_blank">/api/games</a> <p>List all games</p></li>
            <li><span class="http-method">GET</span> <a id="link-one" href="/api/games/1" target="_blank">/api/games/:id</a> <p>Single game</p></li>
            <li><span class="http-method">POST</span> <a id="link-post" href="/api/games" target="_blank">/api/games</a> <p>Add a new matchup (use form below)</p></li>
          </ul>
        </div>
      </div>

      <div>
        <div class="preview-card">
          <p class="muted">Live JSON Preview (iframe)</p>
          <iframe id="json-frame" title="Game Day API response" src="/api/games" loading="lazy"></iframe>
        </div>
        <div class="preview-card">
          <p class="muted">Live JSON (pretty)</p>
          <pre id="json-pretty" style="white-space:pre-wrap;background:#111;color:#0f0;padding:12px;border-radius:12px;min-height:200px;overflow:auto;">Loading…</pre>
          <button id="refresh" style="margin-top:8px;border:none;border-radius:10px;padding:8px 12px;background:#111;color:#fff;cursor:pointer">Refresh JSON</button>
        </div>
      </div>
    </header>

    <!-- React App Root -->
    <div id="react-root"></div>
  </main>

  <!-- GameForm React Component -->
  <script type="text/babel" src="GameForm.jsx"></script>
  
  <!-- Initialize and Mount React App -->
  <script type="text/babel">
    const { createRoot } = ReactDOM;
    const API_BASE = window.__GAME_DAY_API_BASE__ || window.location.origin;

    // Helper function for JSON preview
    function $(sel) { return document.querySelector(sel); }

    async function loadJSON() {
      try {
        const r = await fetch(API_BASE + "/api/games");
        const data = await r.json();
        if ($("#json-pretty")) {
          $("#json-pretty").textContent = JSON.stringify(data, null, 2);
        }
        // Fix the iframe + links to use correct base
        if ($("#json-frame")) {
          $("#json-frame").src = API_BASE + "/api/games";
        }
        if ($("#link-all")) $("#link-all").href = API_BASE + "/api/games";
        if ($("#link-post")) $("#link-post").href = API_BASE + "/api/games";
        if ($("#link-one")) $("#link-one").href = API_BASE + "/api/games/1";
      } catch (e) {
        if ($("#json-pretty")) {
          $("#json-pretty").textContent = "Failed to load JSON.";
        }
      }
    }

    // Refresh button handler
    if ($("#refresh")) {
      $("#refresh").addEventListener("click", loadJSON);
    }

    // Initial JSON load
    loadJSON();

    // Wait for GameForm component to load, then mount React App
    function mountApp() {
      if (typeof App !== 'undefined') {
        const root = createRoot(document.getElementById('react-root'));
        root.render(React.createElement(App));
      } else {
        // Retry after a short delay if component hasn't loaded yet
        setTimeout(mountApp, 100);
      }
    }

    // Start mounting when DOM is ready
    if (document.readyState === 'loading') {
      document.addEventListener('DOMContentLoaded', mountApp);
    } else {
      mountApp();
    }
  </script>
</body>
</html>
